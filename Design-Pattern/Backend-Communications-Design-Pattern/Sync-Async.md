# 개요

- Udemy 백엔드 엔지니어링 (Backend Engineering) 마스터하기! (중/고급자 과정) - Hussein Nasser 강의를 듣고 정리한 내용.

- Synctnous vs Asyncronous 방식에 대한 정리

# 정리

1. 동기(Synchronous) 방식은 요청을 보내고 응답을 받을 때까지 기다리는 방식이다. 요청을 보내고 응답을 받을 때까지 다른 작업을 수행하지 않는다.

- 호출자는 요청을 보내고 응답을 받을 때까지 기다려야 한다.
  - 이때 프로세스가 디스크에 I/O를 요청하면 프로세스는 그동안 아무런 작업을 하지 않기 때문에 CPU에 의해 해당 프로세스는 컨텍스트스위칭이 발생하고 해당 프로세스는 block 상태가 된다.
- 수신자가 응답을 하면 호출자는 block이 해제 된다.
- 예시

  - 프로그램은 OS에게 Disk read를 요청한다.
  - 프로그램의 main thread는 CPU에서 제외시킨다.
  - 읽기가 끝나면 프로그램은 실행을 다시 재개할 수 있고 다시 한 번 컨텍스트 스위칭이 발생한다. -> 이런 비용이 발생하는 것이다.

  - 참고로 파일을 읽는다는 것은
    - 프로그램에서 커널로 요청이 이동하고
    - 커널 -> 드라이버 -> 디스크 컨트롤러 (ssd or hdd) 로 요청을 보낸다. 커널은 이 요청의 응답을 기다린다.
    - 사실상 app 또는 커널은 일을 하지 않고 기다리기만 한다.

2. 비동기(Asynchronous) 방식은 요청을 보내고 응답을 기다리지 않고 다른 작업을 수행할 수 있다. 요청을 보내고 응답을 받을 때까지 다른 작업을 수행할 수 있다.

- 호출자는 요청을 보내고 응답을 받을 떄까지 작업을 수행할 수 있다.
- 서버가 응답을 받았는지 아닌지 확인하는 방법
  1. epol : 리눅스에서 사용하는 방법이며 response가 준비되었는지 계속 확인
  2. io_uring : 수신자는 작업이 완료되면 call back을 보낸다. windows, iocp or 리눅스의 IOUreq 에서 발생. 작업이 완료되면 CQ(COMPLETION QUEUE)에 작업이 완료되었다는 메시지를 보낸다.
  3. Node.js에서 epoll을 사용할 수 없거나 스택을 완료할 수 없는 경우엔 blocked된 새 스레드를 활성화한다.
  - Nodejs의 경우 linux의 경우 epoll을, windows의 경우 iocp를 사용한다.
- 예시

  - 프로그램은 보조 스레드를 활성화한다.
  - 보조 스레드는 disk로부터 읽고 OS는 보조 스레드를 block한다. (단시 보조 스레트만 블록된다.)
  - 쓰레드가 읽기를 완료하면 메인 쓰레드에 call back을 호출한다.

- 참고로 Node.js의 async / await은 코드가 순서대로 작동되게 한다. cpu가 막힌 것이 아니다.
